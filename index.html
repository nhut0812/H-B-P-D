<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Thi·ªáp Sinh Nh·∫≠t ‚Äì Tuy·∫øt Ng·ªçc</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Pacifico&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e1024; --panel:#1a1d3a; --text:#f7f8ff; --muted:#b6bbd8;
    --accent:#ff7ab6; --accent2:#6ee6ff; --gold:#ffcf4a; --frost:#fff7fb;
    --cake-pink:#ffb7d9; --cake-cream:#ffe6f4; --plate:#d6e2ff;
    --candle:#69d0ff; --flame:#ffb200;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    background:
      radial-gradient(1200px 600px at 80% -200px, #1d2348 0%, transparent 60%),
      radial-gradient(1000px 700px at -100px 100%, #2a1a43 0%, transparent 65%),
      var(--bg);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    display:flex; align-items:center; justify-content:center;
    overflow-x:hidden;
  }
  .app{ width:min(980px,96vw); padding:24px }

  .card{
    background:linear-gradient(165deg,#262a54,#181a35);
    border:1px solid #2c2f63; border-radius:20px;
    box-shadow:0 14px 48px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.05);
    overflow:hidden; position:relative;
  }
  .cover{ padding:48px 28px; text-align:center; transition:.6s ease }
  .title{ font-size:clamp(26px,4.4vw,40px); margin:0 0 8px }
  .subtitle{ color:var(--muted); margin:0 0 22px }
  .btn{
    appearance:none; border:0; cursor:pointer; padding:14px 20px; border-radius:12px;
    font-weight:800; letter-spacing:.3px;
    background:linear-gradient(180deg,var(--accent),#ff4fa1); color:#240018;
    box-shadow:0 10px 28px rgba(255,79,161,.35); transition:transform .08s ease;
  }
  .btn:hover{ transform:translateY(-1px) }
  .btn:active{ transform:translateY(1px) scale(.98) }

  .inside{ max-height:0; overflow:hidden; opacity:.0; padding:0; transition:max-height .8s ease, opacity .6s ease, padding .6s ease }
  .card.opened .cover{ transform:translateY(-8px) scale(.985); opacity:.5; filter:blur(.5px) }
  .card.opened .inside{ max-height:2000px; opacity:1; padding:28px }

  .stage{ display:flex; flex-direction:column; align-items:center; gap:16px }
  .cake-wrap{ position:relative; width:min(560px,90vw); aspect-ratio:1/1; margin:6px auto }
  .plate{
    position:absolute; left:50%; transform:translateX(-50%); bottom:-14px;
    width:88%; height:22px; border-radius:30px;
    background: radial-gradient(ellipse at center, var(--plate), #c5d3fb 65%, #a3b3ea 100%);
    filter: drop-shadow(0 10px 24px rgba(0,0,0,.35));
  }
  .cake{
    position:absolute; inset:6% 6% 10% 6%;
    border-radius:50%;
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.7), transparent 30%),
      conic-gradient(from 0deg, #ffd7ec, #ffe9f6, #ffd7ec);
    box-shadow: inset 0 0 0 10px var(--cake-cream), inset 0 0 0 20px var(--cake-pink), 0 12px 32px rgba(0,0,0,.25);
    display:grid; place-items:center; text-align:center; padding:24px;
  }
  .cake .name{
    max-width:85%;
    font-family:'Great Vibes','Pacifico',cursive;
    font-weight:400;
    line-height:1.05;
    font-size:clamp(32px,6.2vw,64px);
    letter-spacing:.5px;
    color:#fff;
    text-shadow:
      0 1px 0 #ffc6e5,
      0 2px 0 #ffadd7,
      0 6px 18px rgba(255,146,194,.6),
      0 12px 32px rgba(181,243,255,.35);
    position:relative;
  }
  .cake .name .sub{
    display:block; font-size:.62em; letter-spacing:1px; text-transform:uppercase;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: linear-gradient(90deg,#fff,#ffe08a 35%,#ff92c2 70%,#b5f3ff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    font-weight:900;
  }
  .sparkles{
    position:absolute; inset:0; pointer-events:none; border-radius:50%;
    background:
      radial-gradient(3px 3px at 15% 25%, #fff8, transparent 60%),
      radial-gradient(3px 3px at 85% 30%, #fff8, transparent 60%),
      radial-gradient(3px 3px at 30% 75%, #fff8, transparent 60%),
      radial-gradient(3px 3px at 70% 65%, #fff8, transparent 60%);
    filter: drop-shadow(0 0 8px rgba(255,255,255,.6));
  }

  .ring{ position:absolute; inset:4% 4% 8% 4%; border-radius:50%; pointer-events:none }

  .candle{
    --size:54px; position:absolute; left:50%; top:50%;
    width:12px; height:var(--size);
    transform-origin:50% calc(100% - 8px);
    background:linear-gradient(180deg,var(--candle),#39c5ff);
    border-radius:6px; box-shadow:inset 0 -6px 0 rgba(0,0,0,.08);
  }
  .candle .wick{ position:absolute; top:-8px; left:50%; transform:translateX(-50%); width:2px; height:10px; background:#333; border-radius:1px }
  .candle::before{
    content:""; position:absolute; top:-22px; left:50%; transform:translateX(-50%);
    width:14px; height:20px; border-radius:10px 10px 8px 8px;
    background:radial-gradient(circle at 50% 35%, #fffad0 0, var(--flame) 45%, #ff7a00 66%, transparent 69%);
    filter: drop-shadow(0 0 8px rgba(255,176,0,.9));
    animation:flicker .12s infinite alternate;
  }
  .candle.out::before{ opacity:0; animation:none; filter:none }
  @keyframes flicker{ from{transform:translateX(-50%) scale(1)} to{transform:translateX(-50%) scale(1.06) translateY(-1px)} }

  .controls{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center }
  .btn.secondary{ background:linear-gradient(180deg,var(--accent2),#38dcff); color:#001d28; box-shadow:0 10px 28px rgba(56,220,255,.35) }
  .hint{ color:var(--muted); text-align:center }

  /* Modal popup qu√† */
  .modal{ position:fixed; inset:0; display:none; place-items:center; background: radial-gradient(900px 700px at 70% 0%, rgba(127,144,255,.22), transparent 60%), rgba(5,7,18,.58); backdrop-filter: blur(6px); z-index:60 }
  .modal.show{ display:grid }
  .pop{
    width:min(880px,92vw);
    background:linear-gradient(165deg,#272a55,#171a36);
    border:1px solid #2b2e60; border-radius:18px;
    box-shadow:0 16px 60px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.05);
    padding:20px 20px 16px; position:relative; overflow:hidden;
  }
  .pop .header{ display:flex; align-items:center; justify-content:center; gap:8px; font-weight:900; letter-spacing:.3px; margin-bottom:8px }
  .gift{ font-size:46px; filter:drop-shadow(0 6px 16px rgba(0,0,0,.35)); animation:bounce 1.2s ease infinite }
  @keyframes bounce{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
  .question{ text-align:center; margin:2px 0 10px; color:var(--text) }

  /* Arena: INIT = hai n√∫t n·∫±m c√πng 1 h√†ng; sau nh·∫•n "C√≥" b·∫Øt ƒë·∫ßu cho "C√≥" ch·∫°y */
  .arena{
    position:relative; height:min(58vh,520px);
    border-radius:14px; overflow:hidden;
    outline:1px dashed rgba(255,255,255,.06);
    background:
      radial-gradient(800px 400px at -100px -120px, rgba(255,255,255,.06), transparent 60%),
      radial-gradient(800px 400px at 120% 120%, rgba(255,255,255,.05), transparent 60%);
  }
  .arena.init{
    display:flex; align-items:center; justify-content:center; gap:16px;
  }
  .btn-yes,.btn-no{
    position:absolute; border:0; cursor:pointer; font-weight:900; letter-spacing:.2px;
    padding:12px 18px; border-radius:12px;
  }
  .arena.init .btn-yes, .arena.init .btn-no{ position:static } /* c√πng m·ªôt h√†ng */

  .btn-yes{
    background:linear-gradient(180deg,#a6ffb5,#4dff7a);
    color:#053e18; box-shadow:0 10px 26px rgba(77,255,122,.28);
    left:10%; top:50%; transform:translate(-50%,-50%); /* d√πng translate ƒë·ªÉ neo theo t√¢m */
  }
  .btn-no{
    background:linear-gradient(180deg,#ffd36e,#ffbb38);
    color:#3f2500; box-shadow:0 10px 26px rgba(255,187,56,.28);
    right:10%; top:50%; transform:translate(-50%,-50%);
    transition: font-size .2s ease, padding .2s ease;
  }

  /* Khi "Kh√¥ng" b·ªã ƒë√≥ng bƒÉng, gi·ªØ nguy√™n v·ªã tr√≠ theo t√¢m */
  .anchored{
    position:absolute !important;
    transform:translate(-50%,-50%) !important;
  }

  .close-x{ position:absolute; right:10px; top:8px; background:transparent; border:0; color:#d4d7ff; font-size:26px; cursor:pointer }

  .final{ display:none; text-align:center; margin-top:10px }
  .wish{ font-size:clamp(22px,4.6vw,38px); margin:8px 0 10px; font-weight:900; text-shadow:0 6px 18px rgba(0,0,0,.25) }
  .note{ color:var(--muted) }

  .confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:80 }
  .confetti i{ position:absolute; width:8px; height:14px; background:hsl(var(--h) 90% 60%); top:-20px; left:var(--x,50%); transform:rotate(var(--r,0deg)); animation:fall var(--d,3s) linear forwards; border-radius:2px }
  @keyframes fall{ to{ transform: translateY(110vh) rotate(1turn) } }
</style>
</head>
<body>
  <main class="app">
    <section class="card" id="card">
      <div class="cover">
        <h1 class="title">üíå Thi·ªáp ch√∫c m·ª´ng sinh nh·∫≠t</h1>
        <p class="subtitle">Nh·∫•n ‚ÄúM·ªü thi·ªáp‚Äù ƒë·ªÉ xem chi·∫øc b√°nh tr√≤n lung linh d√†nh cho Tuy·∫øt Ng·ªçc üéâ</p>
        <button class="btn" id="openCard">M·ªü thi·ªáp</button>
      </div>

      <div class="inside">
        <div class="stage">
          <div class="cake-wrap" aria-label="B√°nh kem h√¨nh tr√≤n">
            <div class="plate"></div>
            <div class="cake">
              <div class="sparkles" aria-hidden="true"></div>
              <div class="name">
                Ch√∫c m·ª´ng sinh nh·∫≠t
                <span class="sub">Tuy·∫øt Ng·ªçc ‚ú®</span>
              </div>
              <div class="ring" id="ring"><!-- Candles by JS --></div>
            </div>
          </div>

          <div class="controls">
            <button class="btn secondary" id="blow">üéÇ Th·ªïi n·∫øn</button>
          </div>
          <p class="hint">C√≥ 22 c√¢y n·∫øn ƒëang t·ªèa s√°ng quanh m√©p b√°nh‚Ä¶</p>
        </div>

        <div class="final" id="final">
          <div class="confetti" id="confetti"></div>
          <p class="wish">Ch√∫c m·ª´ng sinh nh·∫≠t, Tuy·∫øt Ng·ªçc! üéâ Ch√∫c tu·ªïi m·ªõi th·∫≠t r·ª±c r·ª°, lu√¥n kh·ªèe m·∫°nh, b√¨nh an v√† th√†nh c√¥ng v·ªõi m·ªçi ∆∞·ªõc m∆°!</p>
          <p class="note">C·∫£m ∆°n v√¨ ƒë√£ ‚Äúkh√¥ng‚Äù nh·∫≠n qu√† ƒë·ªÉ nh·∫≠n l·ªùi ch√∫c si√™u x·ªãn n√†y üíñ</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Popup Qu√† -->
  <section class="modal" id="modal">
    <div class="pop">
      <button class="close-x" id="closeModal" title="ƒê√≥ng">√ó</button>
      <div class="header">
        <div class="gift" aria-hidden="true">üéÅ</div>
        <h3>Qu√† b√≠ m·∫≠t cho Tuy·∫øt Ng·ªçc</h3>
        <div class="gift" aria-hidden="true">üéÅ</div>
      </div>
      <p class="question">C√≥ mu·ªën nh·∫≠n qu√† kh√¥ng?</p>
      <div class="arena init" id="arena">
        <!-- INIT: c√πng 1 h√†ng, n·∫±m gi·ªØa -->
        <button class="btn-yes" id="yesBtn">C√≥ ü•∞</button>
        <button class="btn-no" id="noBtn">Kh√¥ng üòÜ</button>
      </div>
    </div>
  </section>

<script>
(() => {
  const TOTAL = 22;

  const card = document.getElementById('card');
  const openCard = document.getElementById('openCard');
  const blowBtn = document.getElementById('blow');
  const ring = document.getElementById('ring');

  const modal = document.getElementById('modal');
  const closeModal = document.getElementById('closeModal');
  const arena = document.getElementById('arena');
  const yesBtn = document.getElementById('yesBtn');
  const noBtn = document.getElementById('noBtn');

  const final = document.getElementById('final');
  const confettiBox = document.getElementById('confetti');

  /* 1) M·ªü thi·ªáp */
  openCard.addEventListener('click', () => {
    card.classList.add('opened');
    setTimeout(() => blowBtn.focus(), 400);
  });

  /* 2) T·∫°o 22 c√¢y n·∫øn quanh m√©p b√°nh */
  function placeCandles(){
    ring.innerHTML = '';
    const rect = ring.getBoundingClientRect();
    const radius = Math.min(rect.width, rect.height)/2 - 6;
    for (let i = 0; i < TOTAL; i++){
      const angle = (i / TOTAL) * 360;
      const c = document.createElement('div');
      c.className = 'candle';
      c.style.transform = `translate(-50%, -100%) rotate(${angle}deg) translate(${radius}px) rotate(${-angle}deg)`;
      const wick = document.createElement('div');
      wick.className = 'wick';
      c.appendChild(wick);
      ring.appendChild(c);
    }
  }
  window.addEventListener('load', () => setTimeout(placeCandles, 60));
  window.addEventListener('resize', placeCandles);

  /* 3) Th·ªïi n·∫øn ng·∫´u nhi√™n r·ªìi b·∫≠t popup */
  let blowing = false;
  blowBtn.addEventListener('click', async () => {
    if (blowing) return;
    blowing = true;
    blowBtn.disabled = true;
    blowBtn.textContent = 'ƒêang th·ªïi... üí®';

    const list = Array.from(ring.querySelectorAll('.candle'));
    const order = list.map((_,i)=>i);
    for (let i = order.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i+1));
      [order[i], order[j]] = [order[j], order[i]];
    }
    for (const idx of order){
      list[idx].classList.add('out');
      await new Promise(r => setTimeout(r, 150));
    }
    blowBtn.textContent = 'ƒê√£ th·ªïi xong! üéâ';
    setTimeout(()=> modal.classList.add('show'), 420);
  });

  /* 4) ‚ÄúC√≥‚Äù ch·ªâ n√© khi NH·∫§N v√†o n√≥; ‚ÄúKh√¥ng‚Äù KH√îNG BAO GI·ªú di chuy·ªÉn */
  let clicksOnYes = 0;
  function moveYesInsideArena(){
    const bounds = arena.getBoundingClientRect();
    const btnRect = yesBtn.getBoundingClientRect();
    const x = Math.max(20, Math.floor(Math.random() * (bounds.width - btnRect.width - 20)));
    const y = Math.max(20, Math.floor(Math.random() * (bounds.height - btnRect.height - 20)));
    yesBtn.style.left = x + 'px';
    yesBtn.style.top  = y + 'px';
    yesBtn.style.transform = 'translate(-50%,-50%)';
  }

  yesBtn.addEventListener('click', (e) => {
    e.preventDefault();
    clicksOnYes++;

    // L·∫ßn nh·∫•n ƒë·∫ßu ti√™n: chuy·ªÉn t·ª´ h√†ng ngang -> s√¢n ch∆°i, nh∆∞ng "Kh√¥ng" b·ªã ƒë√≥ng bƒÉng t·∫°i ch·ªó
    if (arena.classList.contains('init')) {
      // T√≠nh t√¢m c·ªßa m·ªói n√∫t so v·ªõi arena
      const aRect = arena.getBoundingClientRect();
      const noRect = noBtn.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();

      const noCX = noRect.left + noRect.width/2 - aRect.left;
      const noCY = noRect.top  + noRect.height/2 - aRect.top;
      const yesCX = yesRect.left + yesRect.width/2 - aRect.left;
      const yesCY = yesRect.top  + yesRect.height/2 - aRect.top;

      // B·ªè tr·∫°ng th√°i init (kh√¥ng c√≤n flex)
      arena.classList.remove('init');

      // ‚Äúƒê√≥ng bƒÉng‚Äù KH√îNG: neo tuy·ªát ƒë·ªëi t·∫°i v·ªã tr√≠ ƒëang c√≥ v√† KH√îNG c·∫≠p nh·∫≠t n·ªØa
      noBtn.classList.add('anchored');
      noBtn.style.left = noCX + 'px';
      noBtn.style.top  = noCY + 'px';

      // Thi·∫øt l·∫≠p v·ªã tr√≠ ban ƒë·∫ßu cho C√ì r·ªìi cho ch·∫°y t·ª´ l·∫ßn sau
      yesBtn.classList.add('anchored');
      yesBtn.style.left = yesCX + 'px';
      yesBtn.style.top  = yesCY + 'px';
      // ngay l·∫≠p t·ª©c n√© sang ch·ªó kh√°c ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng
      moveYesInsideArena();
    } else {
      // Nh·ªØng l·∫ßn ti·∫øp theo ch·ªâ di chuy·ªÉn C√ì
      moveYesInsideArena();
    }

    // L√†m "Kh√¥ng" b·ª± v√¥ h·∫°n nh∆∞ng KH√îNG di chuy·ªÉn
    const base = 16; // px
    const size = base + clicksOnYes * 2;
    noBtn.style.fontSize = size + 'px';
    noBtn.style.padding = (12 + clicksOnYes) + 'px ' + (18 + clicksOnYes) + 'px';
  }, {passive:false});

  // ƒê√≥ng popup (tu·ª≥ ch·ªçn)
  closeModal.addEventListener('click', () => modal.classList.remove('show'));

  // 5) Ch·ªçn "Kh√¥ng" => l·ªùi ch√∫c + confetti
  noBtn.addEventListener('click', () => {
    modal.classList.remove('show');
    final.style.display = 'block';
    final.scrollIntoView({behavior:'smooth', block:'center'});
    shootConfetti();
  });

  /* Confetti ƒë∆°n gi·∫£n */
  function shootConfetti(){
    const N = 140;
    confettiBox.innerHTML = '';
    for (let i = 0; i < N; i++){
      const piece = document.createElement('i');
      const hue = Math.floor(Math.random()*360);
      piece.style.setProperty('--h', hue);
      piece.style.setProperty('--x', Math.random()*100 + 'vw');
      piece.style.setProperty('--d', (2.5 + Math.random()*2.8) + 's');
      piece.style.setProperty('--r', (Math.random()*360) + 'deg');
      confettiBox.appendChild(piece);
    }
    setTimeout(() => { confettiBox.innerHTML=''; }, 6500);
  }
})();
</script>
</body>
</html>
